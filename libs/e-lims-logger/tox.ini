[tox]
envlist = py310, py311, linters, documentation, build
isolated_build = true
skipdist = true

[tox:.package]
basepython = python3

[testenv]
skip_install = true
allowlist_externals = poetry
commands =
    poetry run pytest --cov=tests .
    poetry run coverage xml  

[testenv:documentation]
skip_install = true
allowlist_externals = poetry
commands = poetry run sphinx-build -E -W -c docs/src -b html docs/src docs/build/html

[testenv:black]
skip_install = true
allowlist_externals = poetry
commands = poetry run black src/ tests/

[testenv:ruff]
skip_install = true
allowlist_externals = poetry
commands = poetry run ruff src/ tests/

[testenv:mypy]
skip_install = true
allowlist_externals = poetry
commands = poetry run mypy src/ tests/

[testenv:bandit]
skip_install = true
allowlist_externals = poetry
commands = poetry run bandit src/ tests/

[testenv:build]
skip_install = true
allowlist_externals = poetry
commands = poetry build

[testenv:linters]
skip_install = true
deps =
    {[testenv:black]deps}
    {[testenv:ruff]deps}
    {[testenv:mypy]deps}
    {[testenv:bandit]deps}
commands =
    {[testenv:black]commands}
    {[testenv:ruff]commands}
    {[testenv:mypy]commands}
    {[testenv:bandit]commands}

[pytest]
norecursedirs = .git .* *.egg* old docs dist build
addopts = --doctest-modules
testpaths = tests/